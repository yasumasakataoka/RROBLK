<script type="text/javascript"> var id = "r_itms"; var p_authenticity_token = "gO1RwUnHGkLM4pSKMN90iZ+dDfYVrI17V3NZZYhInho=";var ge; var lastsel; var cellNames = ["itm_code","itm_name","itm_weight","itm_design","itm_model","itm_std","itm_material","itm_consumtype","itm_itmtype","itm_expiredate","itm_remark","itm_minqty","itm_packqty","itm_deth","itm_wide","itm_length","itm_created_at","itm_update_ip","usergroup_name_upd","usergroup_code_upd","person_remark_upd","person_email_upd","person_name_upd","person_code_upd","itm_person_id_upd","unit_remark","unit_name","unit_code","itm_unit_id","itm_id","itm_updated_at","id"]; jQuery(document).ready(function(){ var mygrid = jQuery("#r_itms").jqGrid({ url:"/screen/disp?q=r_itms", editurl:"/screen/add_upd_del", datatype: "xml", colNames:["品目code","品目name","品目weight","品目design","品目model","品目std","品目material","品目consumtype","品目itmtype","品目expiredate","品目remark","品目minqty","品目packqty","品目deth","品目wide","品目length","品目createdat","品目updateip","usergroupnameupd","usergroupcodeupd","personremarkupd","personemailupd","personnameupd","personcodeupd","","unitremark","unitname","unitcode","","","品目updatedat",""], colModel:[{name:"itm_code", index:"itm_code",hidden:false,editrules:{required:true},width:240,search:true,editable:true,formoptions:{rowpos:1,colpos:1} },{name:"itm_name", index:"itm_name",hidden:false,editrules:{required:true},width:300,search:true,editable:true,formoptions:{rowpos:1,colpos:2} },{name:"itm_weight", index:"itm_weight",hidden:false,editrules:{required:false},width:132,search:true,editable:true,formoptions:{rowpos:9,colpos:1} },{name:"itm_design", index:"itm_design",hidden:false,editrules:{required:false},width:300,search:true,editable:true,formoptions:{rowpos:8,colpos:1} },{name:"itm_model", index:"itm_model",hidden:false,editrules:{required:false},width:300,search:true,editable:true,formoptions:{rowpos:6,colpos:1} },{name:"itm_std", index:"itm_std",hidden:false,editrules:{required:false},width:300,search:true,editable:true,formoptions:{rowpos:5,colpos:1} },{name:"itm_material", index:"itm_material",hidden:false,editrules:{required:false},width:300,search:true,editable:true,formoptions:{rowpos:12,colpos:1} },{name:"itm_consumtype", index:"itm_consumtype",hidden:false,editrules:{required:false},width:6,search:true,editable:true,formoptions:{rowpos:3,colpos:1} },{name:"itm_itmtype", index:"itm_itmtype",hidden:false,editrules:{required:false},width:6,search:true,editable:true,formoptions:{rowpos:2,colpos:1} },{name:"itm_expiredate", index:"itm_expiredate",hidden:false,editrules:{required:false},width:60,search:true,editable:true,formoptions:{rowpos:16,colpos:1} },{name:"itm_remark", index:"itm_remark",hidden:false,editrules:{required:false},width:300,search:true,editable:true,formoptions:{rowpos:15,colpos:1} },{name:"itm_minqty", index:"itm_minqty",hidden:false,editrules:{required:false},width:132,search:true,editable:true,formoptions:{rowpos:14,colpos:1} },{name:"itm_packqty", index:"itm_packqty",hidden:false,editrules:{required:false},width:132,search:true,editable:true,formoptions:{rowpos:13,colpos:1} },{name:"itm_deth", index:"itm_deth",hidden:false,editrules:{required:false},width:132,search:true,editable:true,formoptions:{rowpos:12,colpos:1} },{name:"itm_wide", index:"itm_wide",hidden:false,editrules:{required:false},width:132,search:true,editable:true,formoptions:{rowpos:11,colpos:1} },{name:"itm_length", index:"itm_length",hidden:false,editrules:{required:false},width:132,search:true,editable:true,formoptions:{rowpos:10,colpos:1} },{name:"itm_created_at", index:"itm_created_at",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:17,colpos:1} },{name:"itm_update_ip", index:"itm_update_ip",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:18,colpos:1} },{name:"usergroup_name_upd", index:"usergroup_name_upd",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:19,colpos:1} },{name:"usergroup_code_upd", index:"usergroup_code_upd",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:20,colpos:1} },{name:"person_remark_upd", index:"person_remark_upd",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:21,colpos:1} },{name:"person_email_upd", index:"person_email_upd",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:22,colpos:1} },{name:"person_name_upd", index:"person_name_upd",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:23,colpos:1} },{name:"person_code_upd", index:"person_code_upd",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:24,colpos:1} },{name:"itm_person_id_upd", index:"itm_person_id_upd",hidden:true,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:25,colpos:1} },{name:"unit_remark", index:"unit_remark",hidden:false,editrules:{required:false},width:300,search:true,editable:false,formoptions:{rowpos:26,colpos:1} },{name:"unit_name", index:"unit_name",hidden:false,editrules:{required:true},width:60,search:true,editable:true,formoptions:{rowpos:4,colpos:2} },{name:"unit_code", index:"unit_code",hidden:false,editrules:{required:true},width:18,search:true,editable:true,formoptions:{rowpos:4,colpos:1} },{name:"itm_unit_id", index:"itm_unit_id",hidden:true,editrules:{required:false},width:132,search:true,editable:false,formoptions:{rowpos:27,colpos:1} },{name:"itm_id", index:"itm_id",hidden:true,editrules:{required:false},width:132,search:true,editable:false,formoptions:{rowpos:28,colpos:1} },{name:"itm_updated_at", index:"itm_updated_at",hidden:false,editrules:{required:false},width:60,search:true,editable:false,formoptions:{rowpos:29,colpos:1} },{name:"id", index:"id",hidden:true,editrules:{required:false},width:132,search:true,editable:false,formoptions:{rowpos:30,colpos:1} }], pager: jQuery("#r_itms_pager"), rowNum:50, rowList:[50,250,1000,10000], imgpath: "/images/jqgrid", viewrecords: false, width:1800, height: 200, sortname: "", sortorder: "", multiSort:true, shrinkToFit: false, scrollrows: true, autowidth: false, rownumbers: false, onCellSelect:function(rowid, iCol,value,e){ var pare_cellname = getUrlVars()["grid_key"]|| getUrlVars()["gantt_key"]; if(pare_cellname){ var cellname = cellNames[iCol]; if(cellname.match(/_code/i)){ if(window.opener){ var orgname = getUrlVars()["orgname"]; var taskId = getUrlVars()["taskid"]; var rowdata = jQuery("#r_itms").getRowData(rowid); if(taskId]) { name_gantt = getUrlVars()["name_gantt"]; jQuery("tr[taskid=taskId]":[name=name_gantt]", window.opener.document).val(rowdata[org_name]);} else { var screen_name = getUrlVars()["screen_name"]; jQuery("#"+ pare_cellname, window.opener.document).val(value); jQuery("#"+ screen_name, window.opener.document).val(rowdata[org_name]);} window.close();}}}}, caption: "品目マスタ" }) 
.navGrid("#r_itms_pager", {refresh:true,view:true,edit:false,add:false,del:false,search:false }) 
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"Search" ,buttonicon:"ui-icon-search" ,onClickButton: function() {mygrid[0].toggleToolbar();}, position:"right" })
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"Add" ,buttonicon:"ui-icon-plusthick" ,onClickButton: function(){ jQuery("#r_itms").editGridRow("new",{top:100,left:50,width:1200,height:600,dataheight:500,editCaption:"Add",editData:{q:"r_itms",copy:"add",authenticity_token:p_authenticity_token},afterShowForm: function(formid) { jQuery("input",formid).change(function(){ var chgname = jQuery(this).attr("name"); var chgval = jQuery(this).val(); if(chgname.match(/_code/i)){ if(chgname.match(/^itm/i)){} else{ var newname = "#"+chgname.replace("_code","_name"); jQuery.getJSON("/screen/code_to_name",{"chgname":chgname,"chgval":chgval},function(data){ jQuery(newname,formid).val(data.name); }) } } }); jQuery("input",formid).click(function(){ var chgname = jQuery(this).attr("name"); var viewval = chgname.split("_"); var newwin; if(chgname.match(/_code/i)){ if(chgname.match(/^itm/i)){} else{ url = "/screen/index?id=" + chgname + "_div_r_" + viewval[0] + "s"; if(!newwin||newwin.closed){ newwin = window.open(url,"blkpopup","width=800,height=300,menubar=no,toolbar=no,status=no,menubar=no,scrollbars=yes");} else{ newwin.focus();} } } })}function getUrlVars() { var vars = [], hash; var hashes = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&"); for(var i = 0; i < hashes.length; i++) { hash = hashes[i].split("="); vars.push(hash[0]); vars[hash[0]] = hash[1]; } return vars; }}); }, position:"right" })
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"Edit" ,buttonicon:"ui-icon-pencil" ,onClickButton: function(){ var gsr = jQuery("#r_itms").getGridParam("selrow"); if(gsr){ jQuery("#r_itms").editGridRow(gsr,{top:100,left:50,width:1200,height:600,dataheight:500,editCaption:"Edit",editData:{q:"r_itms",copy:"edit",authenticity_token:p_authenticity_token},afterShowForm: function(formid) { jQuery("input",formid).change(function(){ var chgname = jQuery(this).attr("name"); var chgval = jQuery(this).val(); if(chgname.match(/_code/i)){ if(chgname.match(/^itm/i)){} else{ var newname = "#"+chgname.replace("_code","_name"); jQuery.getJSON("/screen/code_to_name",{"chgname":chgname,"chgval":chgval},function(data){ jQuery(newname,formid).val(data.name); }) } } }); jQuery("input",formid).click(function(){ var chgname = jQuery(this).attr("name"); var viewval = chgname.split("_"); var newwin; if(chgname.match(/_code/i)){ if(chgname.match(/^itm/i)){} else{ url = "/screen/index?id=" + chgname + "_div_r_" + viewval[0] + "s"; if(!newwin||newwin.closed){ newwin = window.open(url,"blkpopup","width=800,height=300,menubar=no,toolbar=no,status=no,menubar=no,scrollbars=yes");} else{ newwin.focus();} } } })}function getUrlVars() { var vars = [], hash; var hashes = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&"); for(var i = 0; i < hashes.length; i++) { hash = hashes[i].split("="); vars.push(hash[0]); vars[hash[0]] = hash[1]; } return vars; }}); } else { alert("Please select Row") } } , position:"right" })
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"Copy ＆ Add" ,buttonicon:"ui-icon-newwin" ,onClickButton: function(){ var gsr = jQuery("#r_itms").getGridParam("selrow"); if(gsr){ jQuery("#r_itms").editGridRow(gsr,{top:100,left:50,width:1200,height:600,dataheight:500,editCaption:"Copy ＆ Add",editData:{q:"r_itms",copy:"yes",authenticity_token:p_authenticity_token},afterShowForm: function(formid) { jQuery("input",formid).change(function(){ var chgname = jQuery(this).attr("name"); var chgval = jQuery(this).val(); if(chgname.match(/_code/i)){ if(chgname.match(/^itm/i)){} else{ var newname = "#"+chgname.replace("_code","_name"); jQuery.getJSON("/screen/code_to_name",{"chgname":chgname,"chgval":chgval},function(data){ jQuery(newname,formid).val(data.name); }) } } }); jQuery("input",formid).click(function(){ var chgname = jQuery(this).attr("name"); var viewval = chgname.split("_"); var newwin; if(chgname.match(/_code/i)){ if(chgname.match(/^itm/i)){} else{ url = "/screen/index?id=" + chgname + "_div_r_" + viewval[0] + "s"; if(!newwin||newwin.closed){ newwin = window.open(url,"blkpopup","width=800,height=300,menubar=no,toolbar=no,status=no,menubar=no,scrollbars=yes");} else{ newwin.focus();} } } })}function getUrlVars() { var vars = [], hash; var hashes = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&"); for(var i = 0; i < hashes.length; i++) { hash = hashes[i].split("="); vars.push(hash[0]); vars[hash[0]] = hash[1]; } return vars; }}); } else { alert("Please select Row") } } , position:"right" })
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"Delete" ,buttonicon:"ui-icon-trash" ,onClickButton: function(){ var gsr = jQuery("#r_itms").getGridParam("selrow"); if(gsr){ jQuery("#r_itms").delGridRow(gsr,{top:100,left:50,width:1200,height:600,dataheight:500,caption:"Delete",modal:true,delData:{q:"r_itms",copy:"delete",authenticity_token:p_authenticity_token},afterShowForm: function(formid) { jQuery("input",formid).change(function(){ var chgname = jQuery(this).attr("name"); var chgval = jQuery(this).val(); if(chgname.match(/_code/i)){ if(chgname.match(/^itm/i)){} else{ var newname = "#"+chgname.replace("_code","_name"); jQuery.getJSON("/screen/code_to_name",{"chgname":chgname,"chgval":chgval},function(data){ jQuery(newname,formid).val(data.name); }) } } }); jQuery("input",formid).click(function(){ var chgname = jQuery(this).attr("name"); var viewval = chgname.split("_"); var newwin; if(chgname.match(/_code/i)){ if(chgname.match(/^itm/i)){} else{ url = "/screen/index?id=" + chgname + "_div_r_" + viewval[0] + "s"; if(!newwin||newwin.closed){ newwin = window.open(url,"blkpopup","width=800,height=300,menubar=no,toolbar=no,status=no,menubar=no,scrollbars=yes");} else{ newwin.focus();} } } })}function getUrlVars() { var vars = [], hash; var hashes = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&"); for(var i = 0; i < hashes.length; i++) { hash = hashes[i].split("="); vars.push(hash[0]); vars[hash[0]] = hash[1]; } return vars; }}); } else { alert("Please select Row") } } , position:"right" })
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"export to xlsx" ,buttonicon:"ui-icon-arrowthickstop-1-n" ,onClickButton: function() { document.location = "/excelexport/index?q=" + id;}, position:"right" })
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"import from xlsx" ,buttonicon:"ui-icon-arrowthickstop-1-s" ,onClickButton: function() {document.location = "/importfmxlsx/index?q=" + id;}, position:"right" })
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"pdf" ,buttonicon:"ui-icon-print" ,onClickButton: function() {jQuery(".prntclass").toggle();}, position:"right" })
.navButtonAdd("#r_itms_pager",{caption:"" ,title:"ganttchart" ,buttonicon:"ui-icon-calculator" ,onClickButton: function() {var gsr = jQuery("#r_itms").getGridParam("selrow"); if(gsr){jQuery.getJSON("/screen/gantt",{id:gsr,screen_code:"r_itms",authenticity_token:p_authenticity_token},function(ganttdata){ if(jQuery("#ganttcharthtml").is(":hidden")){jQuery("#ganttcharthtml").show("fast");} ge.loadProject( ganttdata);} ); } else {alert("Please select a row"); } return false;}, position:"right" }); jQuery("#r_itms").jqGrid("gridResize",{minWidth:350,maxWidth:1800,minHeight:80, maxHeight:900}); jQuery("#r_itms_select_button").click( function(){ var getid = jQuery("#r_itms").getGridParam("selrow"); var nst_tbl_val = jQuery("#r_itms_select_button :checked").val(); if (getid) { jQuery.get("/screen/nst",{id:getid,nst_tbl_val:nst_tbl_val,authenticity_token:p_authenticity_token} ); } else { alert("Please select a row"); } return false; }); jQuery("#r_itms_printid").append("<b>screen has nopdf_list</b>"); mygrid.filterToolbar();mygrid[0].toggleToolbar(); ge = new GanttMaster(); ge.init(jQuery("#workSpace"));
            var workSpace = jQuery("#workSpace"); workSpace.css({width:jQuery(window).width() - 10,heigt:jQuery(window).height() - 250}); 
            }); function uploadOnServer(){var prj = ge.saveProject();prj.authenticity_token=p_authenticity_token;jQuery.post("/screen/uploadgantt",prj,function(rd){alert(rd.error)},"json");}</script> 
