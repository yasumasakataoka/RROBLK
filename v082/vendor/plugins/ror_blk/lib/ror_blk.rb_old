# RorBlk
 module Xror_blk
      def getblkfobj user_code,code      ## fieldsの名前
      if code =~ /_ID/ or   code == "ID" then
         oragname = code
        else
         orgname = ""      
         fstrsqlx = "select Fobjgrp_name from R_FOBJGRPS where USERGROUP_CODE = '#{user_code}' and"
         fstrsql =  fstrsqlx + "  FOBJECT_CODE = '#{code}' "
         ###  フル項目で指定しているとき
         orgname = plsql.select(:first,fstrsql)[:fobjgrp_name]  if !plsql.select(:first,fstrsql).nil?
         ## p "orgname #{orgname}"
         ## p "code #{code}"
         if orgname.empty? or orgname.nil? then
            orgname = ""
            code.split('_').each do |i|
              fstrsqly =  fstrsqlx +  "   FOBJECT_CODE = '#{i}' "
              # p pstrsqly
              if plsql.select(:first,fstrsqly).nil? then   ## tbl name get
                 fstrsqly =  fstrsqlx +  "  FOBJECT_CODE = '#{i}' "
                 if !plsql.plsql.select(:first,fstrsqly).nil?                                  
                     orgname << plsql.plsql.select(:first,fstrsqly)[:fobjgrp_name]  
                    else
                     orgname << i   
                 end  ## if !plsql
                else
                  orgname << plsql.select(:first,fstrsqly)[:fobjgrp_name]
               end   
            end   ## do code. 
         end ## iforgname
            orgname = code if orgname == "" or orgname.nil?
      end  ## if ocde
      return orgname 
  end  ## def getfobj
  def getblkpobj objecttype,user_code,code  ### field以外の帳票や画面名
      orgname = ""
      pstrsql = "select pobjgrp_name from R_POBJGRPS where "
      pstrsql << " POBJECT_CODE = '#{code}' and USERGROUP_CODE = '#{user_code}' and  POBJECT_OBJECTTYPE = '#{objecttype}' "
      orgname = plsql.select(:first,pstrsql)[:pobjgrp_name] if !plsql.select(:first,pstrsql).nil?
      orgname = code if orgname == "" or orgname.nil?
      return orgname 
  end
  def getblktype code
    tmp_type = plsql.fobjects.first("where code = '#{code}' and Expiredate > sysdate order by Expiredate ")
    if tmp_type.nil? then
       tmp_type = plsql.fobjects.first("where code = '#{code.split("_")[1]}' and Expiredate > sysdate order by Expiredate ")
    end
    if tmp_type.nil? then
       type = code
     else 
       type = tmp_type[:objecttype]
    end
    return type
  end
 end
 
